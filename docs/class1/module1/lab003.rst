Lab – Create the Access Policy
------------------------------------------------

In this section, edit the policy using Visual Policy Editor to enable users to login via AD+MFA, then transition to CertSSO

Task – Open Visual Policy Editor
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~



1. On the CERT_SSO profile line **click** edit under Per-Session Policy

|image8|

2. Click the **+** symbol located on the fallback branch located between the Start and Deny boxes

|image9|

3. Select **Logon Page** under the Logon Tab 
4. Click **Add Item**

|image11|

5. Add an additional field to the logon page by selecting **password** from the Type dropdown on line 3
6. Enter **OTP** for Post Variable Name
7. Enter **OTP** for Session Variable Name
8. Enter **OTP** for Logon Page Input Field #3
9. Click **Save**

|image12|

10. Click the **+** symbol located on the fallback branch located between the Logon Page and Deny boxes

|image13|

11. Under the Authentication tab select **RADIUS Auth**  
12. Click **Add Item**

|image14|

13. Select **RADIUS_SERVERS** from the AAA Server dropdown box
14. Change the password source to **%{session.logon.last.OTP}**
15. Clic **Save**

|image15|

16. Click the **+** symbol located on the Successful branch located between RADIUS Auth and Deny boxes


|image16|

17. under the Authentication Tab select **AD Auth** 
18. Click **Add Item**

|image17|


19. Select **f5lab.local** from the Server dropdown box
20. Click **Save**

|image18|

21. **Click** the + symbol located on the Successful branch located between AD Auth and Deny box
22. Click **Add Item**

|image10|

23. Under the Assignment Tab select **Variable Assign** 
24. Click **Add Item**

|image19|

25. Click **Add new entry**

|image36|

26. Click **change**

|image37|

27. Enter **session.ssl.cert.whole** in the custom variable field

|image38|

28. Locate the F5CertSSO.f5lab.local.txt file in the c:\Labfiles\Agility2020-Ephemeral Authentication directory. 

|image39|

29. Open the file with notepad++ and copy the contents of the file

|image40|

30. Return to Visual Policy editor and past the certificate into the **custom expression** field
31. Click **Finished**

|image41|

Click **Save**

|image42|



32. Click the **Deny** ending icon located on the fallback branch of the Variable Assign Agent

|image20|

33. **Click** Allow
34. **Click** Save

|image21|

35. Click **Apply Access Policy** located in the top left corner to commit the policy changes


.. |image8| image:: /_static/class1/module1/image008.png
.. |image9| image:: /_static/class1/module1/image009.png
.. |image10| image:: /_static/class1/module1/image010.png
.. |image11| image:: /_static/class1/module1/image011.png
.. |image12| image:: /_static/class1/module1/image012.png
.. |image13| image:: /_static/class1/module1/image013.png
.. |image14| image:: /_static/class1/module1/image014.png
.. |image15| image:: /_static/class1/module1/image015.png
.. |image16| image:: /_static/class1/module1/image016.png
.. |image17| image:: /_static/class1/module1/image017.png
.. |image18| image:: /_static/class1/module1/image018.png
.. |image19| image:: /_static/class1/module1/image019.png
.. |image20| image:: /_static/class1/module1/image020.png
.. |image21| image:: /_static/class1/module1/image021.png
.. |image22| image:: /_static/class1/module1/image022.png
.. |image36| image:: /_static/class1/module1/image036.png
.. |image37| image:: /_static/class1/module1/image037.png
.. |image38| image:: /_static/class1/module1/image038.png
.. |image39| image:: /_static/class1/module1/image039.png
.. |image40| image:: /_static/class1/module1/image040.png
.. |image41| image:: /_static/class1/module1/image041.png
.. |image42| image:: /_static/class1/module1/image042.png


